# 系统架构模式: 脚本管理器桌面客户端
*版本: 1.1.1*
*更新时间: 2025年5月*

## 架构概述
采用Electron双进程架构，主进程负责系统API访问和业务逻辑，渲染进程负责用户界面。通过IPC通信实现进程间安全数据交换，确保应用安全性和性能。从脚本执行监控器重构为脚本启动器，使脚本独立运行，提高稳定性和用户体验。

## 核心组件
- **主进程 (main.js)**: 应用生命周期管理、窗口创建、IPC处理、错误抑制
- **渲染进程 (renderer.js)**: 现代化卡片网格界面、右键菜单交互、状态管理
- **预加载脚本 (preload.js)**: 安全的API桥接层
- **脚本管理器 (script-manager.js)**: 脚本数据CRUD操作、元数据存储
- **脚本启动器 (script-executor.js)**: 多语言脚本启动引擎，独立窗口执行
- **文件管理器 (file-manager.js)**: 文件系统操作封装、路径验证

## 设计模式应用
- **模块化模式**: 每个功能独立模块，便于维护和测试
- **观察者模式**: IPC事件驱动的通信机制
- **策略模式**: 不同脚本类型的启动策略
- **单例模式**: 应用实例和数据管理器
- **工厂模式**: 脚本启动器的创建
- **装饰器模式**: 脚本状态跟踪功能

## 数据流
```
用户操作 → 渲染进程 → IPC通信 → 主进程业务逻辑 → 独立脚本进程启动 → 状态反馈 → 界面更新
```

## 关键技术决策
- **Electron框架**: 提供跨平台桌面应用能力，统一Web技术栈
- **JSON数据存储**: 轻量级数据持久化，易于备份和迁移
- **独立进程启动**: 使用spawn+detached模式，脚本独立于主应用运行
- **上下文隔离**: 禁用Node.js集成，通过预加载脚本安全访问API
- **编码处理**: 支持GBK和UTF-8编码，正确处理中文输出
- **GPU加速禁用**: 通过命令行参数禁用GPU相关功能，提高稳定性
- **临时用户数据**: 使用临时目录，避免中文路径和权限问题

## 组件关系
```
main.js (主进程)
├── ScriptManager (数据管理)
├── ScriptExecutor (脚本启动)
├── FileManager (文件操作)
└── IPC Handlers (通信处理)

renderer.js (渲染进程)
├── ScriptManager (界面管理类)
│   ├── Card Grid (卡片网格)
│   ├── Context Menu (右键菜单)
│   ├── Modal Dialog (模态对话框)
│   └── Category Tabs (分类标签)
├── Event Handlers (事件处理)
└── API Calls (通过preload.js)

preload.js (桥接层)
└── electronAPI (安全API暴露)
```

## 安全考虑
- **上下文隔离**: 渲染进程无法直接访问Node.js API
- **预加载脚本**: 提供受控的API访问接口
- **输入验证**: 所有用户输入都经过验证和清理
- **路径安全**: 防止路径遍历攻击
- **错误抑制**: 过滤无害的GPU和缓存错误，提高稳定性

## 性能优化
- **异步操作**: 所有I/O操作使用异步模式
- **进程分离**: 脚本在独立进程中运行，不影响主应用
- **资源管理**: 临时目录存储用户数据，避免权限问题
- **缓存策略**: 合理缓存脚本数据和执行状态
- **错误过滤**: 智能过滤无关错误，减少控制台噪音

---

*本文档描述了项目中使用的系统架构和设计模式。* 