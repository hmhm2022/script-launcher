# 系统架构模式: 脚本管理器桌面客户端
*版本: 1.0*
*更新时间: 2024年12月*

## 架构概述
采用Electron双进程架构，主进程负责系统API访问和业务逻辑，渲染进程负责用户界面。通过IPC通信实现进程间安全数据交换，确保应用安全性和性能。

## 核心组件
- **主进程 (main.js)**: 应用生命周期管理、窗口创建、IPC处理
- **渲染进程 (renderer.js)**: 用户界面逻辑、用户交互处理
- **预加载脚本 (preload.js)**: 安全的API桥接层
- **脚本管理器 (script-manager.js)**: 脚本数据CRUD操作
- **脚本执行器 (script-executor.js)**: 多语言脚本执行引擎
- **文件管理器 (file-manager.js)**: 文件系统操作封装

## 设计模式应用
- **模块化模式**: 每个功能独立模块，便于维护和测试
- **观察者模式**: IPC事件驱动的通信机制
- **策略模式**: 不同脚本类型的执行策略
- **单例模式**: 应用实例和数据管理器
- **工厂模式**: 脚本执行器的创建

## 数据流
```
用户操作 → 渲染进程 → IPC通信 → 主进程业务逻辑 → 文件系统/子进程 → 结果返回 → 界面更新
```

## 关键技术决策
- **Electron框架**: 提供跨平台桌面应用能力，统一Web技术栈
- **JSON数据存储**: 轻量级数据持久化，易于备份和迁移
- **子进程执行**: 隔离脚本执行环境，防止主应用崩溃
- **上下文隔离**: 禁用Node.js集成，通过预加载脚本安全访问API
- **编码处理**: 支持GBK和UTF-8编码，正确处理中文输出

## 组件关系
```
main.js (主进程)
├── ScriptManager (数据管理)
├── ScriptExecutor (脚本执行)
├── FileManager (文件操作)
└── IPC Handlers (通信处理)

renderer.js (渲染进程)
├── UI Components (界面组件)
├── Event Handlers (事件处理)
└── API Calls (通过preload.js)

preload.js (桥接层)
└── electronAPI (安全API暴露)
```

## 安全考虑
- **上下文隔离**: 渲染进程无法直接访问Node.js API
- **预加载脚本**: 提供受控的API访问接口
- **输入验证**: 所有用户输入都经过验证和清理
- **路径安全**: 防止路径遍历攻击

## 性能优化
- **异步操作**: 所有I/O操作使用异步模式
- **进程隔离**: 脚本执行不阻塞主界面
- **资源管理**: 及时清理子进程和临时资源
- **缓存策略**: 合理缓存脚本数据和执行结果

---

*本文档描述了项目中使用的系统架构和设计模式。* 