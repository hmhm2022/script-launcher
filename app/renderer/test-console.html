<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒè·³ç›‘æ§æµ‹è¯•æ§åˆ¶å°</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h3 {
            margin-top: 0;
            color: #555;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }
        .btn-warning:hover {
            background-color: #e0a800;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .status-display {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        .log-info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        .log-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        .log-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .log-success {
            background-color: #d4edda;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å¿ƒè·³ç›‘æ§æµ‹è¯•æ§åˆ¶å°</h1>

        <div class="section">
            <h3>ğŸ“Š å½“å‰çŠ¶æ€</h3>
            <div class="button-group">
                <button class="btn-primary" onclick="getHeartbeatStatus()">è·å–å¿ƒè·³çŠ¶æ€</button>
                <button class="btn-primary" onclick="getSchedulerStatus()">è·å–è°ƒåº¦å™¨çŠ¶æ€</button>
            </div>
            <div id="status-display" class="status-display">ç‚¹å‡»æŒ‰é’®è·å–çŠ¶æ€ä¿¡æ¯...</div>
        </div>

        <div class="section">
            <h3>âš¡ æ‰‹åŠ¨æµ‹è¯•</h3>
            <div class="button-group">
                <button class="btn-success" onclick="triggerHeartbeat()">ç«‹å³è§¦å‘å¿ƒè·³æ£€æŸ¥</button>
            </div>
        </div>

        <div class="section">
            <h3>ğŸš¨ æ•…éšœæ¨¡æ‹Ÿ</h3>
            <div class="button-group">
                <button class="btn-warning" onclick="simulateFailure('scheduler')">æ¨¡æ‹Ÿè°ƒåº¦å™¨æ•…éšœ</button>
                <button class="btn-warning" onclick="simulateFailure('python')">æ¨¡æ‹ŸPythonç¯å¢ƒæ•…éšœ</button>
                <button class="btn-warning" onclick="simulateFailure('script-missing')">æ¨¡æ‹Ÿè„šæœ¬ä¸¢å¤±</button>
                <button class="btn-warning" onclick="simulateHeartbeatFailure()">æ¨¡æ‹Ÿå¿ƒè·³å¼‚å¸¸</button>
            </div>
            <div class="button-group">
                <button class="btn-danger" onclick="resetSimulation()">é‡ç½®æ‰€æœ‰æ¨¡æ‹Ÿæ•…éšœ</button>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ”” é€šçŸ¥ç³»ç»Ÿæµ‹è¯•</h3>
            <div class="button-group">
                <button class="btn-primary" onclick="testSystemNotification()">æµ‹è¯•ç³»ç»Ÿé€šçŸ¥</button>
                <button class="btn-primary" onclick="testTrayNotification()">æµ‹è¯•æ‰˜ç›˜é€šçŸ¥</button>
                <button class="btn-secondary" onclick="checkNotificationPermission()">æ£€æŸ¥é€šçŸ¥æƒé™</button>
                <button class="btn-warning" onclick="testUrgentNotification()">æµ‹è¯•ç´§æ€¥é€šçŸ¥</button>
            </div>
            <div id="notification-status" class="status-display">ç‚¹å‡»æŒ‰é’®æµ‹è¯•é€šçŸ¥åŠŸèƒ½...</div>
        </div>

        <div class="section">
            <h3>ğŸ“ æµ‹è¯•æ—¥å¿—</h3>
            <div id="test-log" class="status-display">æµ‹è¯•æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
            <button class="btn-primary" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <script>
        let logEntries = [];

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logEntries.push({ message: logEntry, type });

            const logDiv = document.getElementById('test-log');
            const entryDiv = document.createElement('div');
            entryDiv.className = `log-entry log-${type}`;
            entryDiv.textContent = logEntry;
            logDiv.appendChild(entryDiv);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            logEntries = [];
            document.getElementById('test-log').innerHTML = 'æµ‹è¯•æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...';
        }

        async function getHeartbeatStatus() {
            try {
                addLog('æ­£åœ¨è·å–å¿ƒè·³çŠ¶æ€...', 'info');
                const result = await window.electronAPI.invoke('get-heartbeat-status');
                if (result.success) {
                    document.getElementById('status-display').textContent =
                        JSON.stringify(result.status, null, 2);
                    addLog('å¿ƒè·³çŠ¶æ€è·å–æˆåŠŸ', 'success');
                } else {
                    addLog(`è·å–å¿ƒè·³çŠ¶æ€å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`è·å–å¿ƒè·³çŠ¶æ€å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function getSchedulerStatus() {
            try {
                addLog('æ­£åœ¨è·å–è°ƒåº¦å™¨çŠ¶æ€...', 'info');
                const result = await window.electronAPI.invoke('get-scheduler-status');
                if (result.success) {
                    document.getElementById('status-display').textContent =
                        JSON.stringify(result.status, null, 2);
                    addLog('è°ƒåº¦å™¨çŠ¶æ€è·å–æˆåŠŸ', 'success');
                } else {
                    addLog(`è·å–è°ƒåº¦å™¨çŠ¶æ€å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`è·å–è°ƒåº¦å™¨çŠ¶æ€å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function triggerHeartbeat() {
            try {
                addLog('æ­£åœ¨è§¦å‘å¿ƒè·³æ£€æŸ¥...', 'info');
                const result = await window.electronAPI.invoke('trigger-heartbeat-test');
                if (result.success) {
                    addLog('å¿ƒè·³æ£€æŸ¥å·²è§¦å‘ï¼Œè¯·æŸ¥çœ‹ç³»ç»Ÿé€šçŸ¥', 'success');
                } else {
                    addLog(`è§¦å‘å¿ƒè·³æ£€æŸ¥å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`è§¦å‘å¿ƒè·³æ£€æŸ¥å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function simulateFailure(failureType) {
            try {
                addLog(`æ­£åœ¨æ¨¡æ‹Ÿ ${failureType} æ•…éšœ...`, 'warning');
                const result = await window.electronAPI.invoke('simulate-failure', failureType);
                if (result.success) {
                    addLog(`${failureType} æ•…éšœæ¨¡æ‹ŸæˆåŠŸï¼Œè¯·è§‚å¯Ÿé€šçŸ¥`, 'warning');
                } else {
                    addLog(`æ¨¡æ‹Ÿæ•…éšœå¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`æ¨¡æ‹Ÿæ•…éšœå¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function resetSimulation() {
            try {
                addLog('æ­£åœ¨é‡ç½®æ‰€æœ‰æ¨¡æ‹Ÿæ•…éšœ...', 'info');
                const result = await window.electronAPI.invoke('reset-simulation');
                if (result.success) {
                    addLog('æ‰€æœ‰æ¨¡æ‹Ÿæ•…éšœå·²é‡ç½®', 'success');
                } else {
                    addLog(`é‡ç½®å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`é‡ç½®å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function testSystemNotification() {
            try {
                addLog('æ­£åœ¨æµ‹è¯•ç³»ç»Ÿé€šçŸ¥...', 'info');
                const result = await window.electronAPI.invoke('test-system-notification');
                if (result.success) {
                    addLog('ç³»ç»Ÿé€šçŸ¥æµ‹è¯•å·²å‘é€ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æ”¶åˆ°é€šçŸ¥', 'success');
                    document.getElementById('notification-status').textContent =
                        `é€šçŸ¥æƒé™: ${result.permission}, æ”¯æŒçŠ¶æ€: ${result.supported}`;
                } else {
                    addLog(`ç³»ç»Ÿé€šçŸ¥æµ‹è¯•å¤±è´¥: ${result.error}`, 'error');
                    document.getElementById('notification-status').textContent = result.error;
                }
            } catch (error) {
                addLog(`ç³»ç»Ÿé€šçŸ¥æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function testTrayNotification() {
            try {
                addLog('æ­£åœ¨æµ‹è¯•æ‰˜ç›˜é€šçŸ¥...', 'info');
                const result = await window.electronAPI.invoke('test-tray-notification');
                if (result.success) {
                    addLog('æ‰˜ç›˜é€šçŸ¥æµ‹è¯•å·²å‘é€ï¼Œè¯·æ£€æŸ¥æ‰˜ç›˜åŒºåŸŸ', 'success');
                } else {
                    addLog(`æ‰˜ç›˜é€šçŸ¥æµ‹è¯•å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`æ‰˜ç›˜é€šçŸ¥æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function checkNotificationPermission() {
            try {
                addLog('æ­£åœ¨æ£€æŸ¥é€šçŸ¥æƒé™...', 'info');
                const result = await window.electronAPI.invoke('check-notification-permission');
                if (result.success) {
                    const status = `
é€šçŸ¥æ”¯æŒ: ${result.supported ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}
ç³»ç»Ÿå¹³å°: ${result.platform}
Electronç‰ˆæœ¬: ${result.electronVersion}
æƒé™çŠ¶æ€: ${result.permission || 'æœªçŸ¥'}`;
                    document.getElementById('notification-status').textContent = status;
                    addLog('é€šçŸ¥æƒé™æ£€æŸ¥å®Œæˆ', 'success');
                } else {
                    addLog(`æ£€æŸ¥é€šçŸ¥æƒé™å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`æ£€æŸ¥é€šçŸ¥æƒé™å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function testUrgentNotification() {
            try {
                addLog('æ­£åœ¨æµ‹è¯•ç´§æ€¥é€šçŸ¥...', 'warning');
                const result = await window.electronAPI.invoke('test-urgent-notification');
                if (result.success) {
                    addLog('ğŸš¨ ç´§æ€¥é€šçŸ¥å·²å‘é€ï¼è¯·ç«‹å³æ£€æŸ¥é€šçŸ¥åŒºåŸŸï¼', 'warning');
                    document.getElementById('notification-status').textContent =
                        'ğŸš¨ ç´§æ€¥é€šçŸ¥å·²å‘é€ï¼Œåº”è¯¥ä¼šå¼ºåˆ¶æ˜¾ç¤ºï¼';
                } else {
                    addLog(`ç´§æ€¥é€šçŸ¥æµ‹è¯•å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`ç´§æ€¥é€šçŸ¥æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function simulateHeartbeatFailure() {
            try {
                addLog('æ­£åœ¨æ¨¡æ‹Ÿå¿ƒè·³å¼‚å¸¸...', 'error');
                const result = await window.electronAPI.invoke('simulate-heartbeat-failure');
                if (result.success) {
                    addLog('ğŸ’” å¿ƒè·³å¼‚å¸¸å·²æ¨¡æ‹Ÿï¼åº”è¯¥ä¼šè§¦å‘å¿ƒè·³ç›‘æ§é€šçŸ¥ï¼', 'error');
                    document.getElementById('notification-status').textContent =
                        'ğŸ’” å¿ƒè·³å¼‚å¸¸å·²æ¨¡æ‹Ÿï¼Œè¯·ç­‰å¾…å¿ƒè·³ç›‘æ§é€šçŸ¥...';
                } else {
                    addLog(`æ¨¡æ‹Ÿå¿ƒè·³å¼‚å¸¸å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`æ¨¡æ‹Ÿå¿ƒè·³å¼‚å¸¸å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è·å–åˆå§‹çŠ¶æ€
        window.addEventListener('DOMContentLoaded', () => {
            addLog('æµ‹è¯•æ§åˆ¶å°å·²åŠ è½½', 'info');
            getHeartbeatStatus();
        });
    </script>
</body>
</html>
